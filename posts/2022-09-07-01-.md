# nslookup & dig
[Reference Link](https://www.ruanyifeng.com./blog/2022/08/dns-query.html)
## how to resolve domain to IP address
域名是樹狀結構,只有"**上級域名**"知道"**下一級域名**"的IP位址.
依序是 "根域名"(root) -> "頂級域名"(TLD) -> "一級域名" -> "二級域名"
* 頂級域名的DNS一共有13個,IP是永遠固定的,已經寫在操作系統裡了 ex: a.root-servers.net:198.41.0.4

查詢步驟:
  1. 查詢根域名服務器取得頂級域名服務器 `.com` (簡稱TLD服務器)的IP
  2. 查詢TLD服務器 `.com` 取得一級域名服務器 `xxx.com` 的IP
  3. 查詢一級域名服務器 'xxx.com' 取得二級域名 `xx.xxx.com` 的IP
  4. 反回IP
```bash=
//*******************************************************************
// 遞歸 DNS 服務器: server會自動遞歸DNS層級來查詢
dig @1.1.1.1 www.google.com

; <<>> DiG 9.10.6 <<>> @1.1.1.1 www.pchome.com.tw
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 41551
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;www.pchome.com.tw.		IN	A

;; ANSWER SECTION:
www.pchome.com.tw.	300	IN	A	34.110.144.106 // <=== PCHOME的IP

;; Query time: 376 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Wed Sep 07 12:15:12 CST 2022
;; MSG SIZE  rcvd: 62

//*******************************************************************
// 根域名服務器查詢 => 沒有回應www.pchome.com.tw的IP,而是返回下一級域名,所以繼續往下查
dig @a.root-servers.net www.pchome.com.tw

; <<>> DiG 9.10.6 <<>> @a.root-servers.net www.pchome.com.tw
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 7560
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 10, ADDITIONAL: 20
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1472
;; QUESTION SECTION:
;www.pchome.com.tw.		IN	A

;; AUTHORITY SECTION:
tw.			172800	IN	NS	a.dns.tw.
tw.			172800	IN	NS	b.dns.tw.
tw.			172800	IN	NS	c.dns.tw.
tw.			172800	IN	NS	d.dns.tw.
tw.			172800	IN	NS	e.dns.tw.
tw.			172800	IN	NS	f.dns.tw.
tw.			172800	IN	NS	g.dns.tw.
tw.			172800	IN	NS	h.dns.tw.
tw.			172800	IN	NS	ns.twnic.net.
tw.			172800	IN	NS	anytld.apnic.net.

;; ADDITIONAL SECTION:
a.dns.tw.		172800	IN	A	203.73.24.25
b.dns.tw.		172800	IN	A	210.201.138.58
c.dns.tw.		172800	IN	A	203.66.87.201
d.dns.tw.		172800	IN	A	60.199.165.186
e.dns.tw.		172800	IN	A	211.20.231.11
f.dns.tw.		172800	IN	A	163.28.1.10
g.dns.tw.		172800	IN	A	220.229.225.195
h.dns.tw.		172800	IN	A	204.61.216.119
ns.twnic.net.		172800	IN	A	192.83.166.11
anytld.apnic.net.	172800	IN	A	202.12.31.53
a.dns.tw.		172800	IN	AAAA	2001:45b1:0:5::25
b.dns.tw.		172800	IN	AAAA	2404:0:10a0::58
c.dns.tw.		172800	IN	AAAA	2001:b020:0:77::1
d.dns.tw.		172800	IN	AAAA	2001:4541:9010:7::186
e.dns.tw.		172800	IN	AAAA	2001:b000:1e0:c000::11
g.dns.tw.		172800	IN	AAAA	2001:cd8:400::195
h.dns.tw.		172800	IN	AAAA	2001:500:14:6119:ad::1
ns.twnic.net.		172800	IN	AAAA	2001:288:1:1006::11
anytld.apnic.net.	172800	IN	AAAA	2001:dd8:12::53

;; Query time: 145 msec
;; SERVER: 198.41.0.4#53(198.41.0.4)
;; WHEN: Wed Sep 07 12:40:40 CST 2022
;; MSG SIZE  rcvd: 643

//*******************************************************************
// 一級域名服務器查詢 => 沒有回應www.pchome.com.tw的IP,而是返回下一級域名,所以繼續往下查
dig @203.73.24.25 www.pchome.com.tw

; <<>> DiG 9.10.6 <<>> @203.73.24.25 www.pchome.com.tw
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 2518
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 5, ADDITIONAL: 6
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;www.pchome.com.tw.		IN	A

;; AUTHORITY SECTION:
pchome.com.tw.		3600	IN	NS	dns2.pchome.com.tw.
pchome.com.tw.		3600	IN	NS	dns.pchome.com.tw.
pchome.com.tw.		3600	IN	NS	dns3.pchome.com.tw.
pchome.com.tw.		3600	IN	NS	wolf.pchome.com.tw.
pchome.com.tw.		3600	IN	NS	cheetah.pchome.com.tw.

;; ADDITIONAL SECTION:
cheetah.pchome.com.tw.	3600	IN	A	210.242.216.93
wolf.pchome.com.tw.	3600	IN	A	203.69.38.86
dns3.pchome.com.tw.	3600	IN	A	34.80.229.255
dns2.pchome.com.tw.	3600	IN	A	211.20.188.153
dns.pchome.com.tw.	3600	IN	A	210.59.230.85

;; Query time: 324 msec
;; SERVER: 203.73.24.25#53(203.73.24.25)
;; WHEN: Wed Sep 07 12:45:58 CST 2022
;; MSG SIZE  rcvd: 223

//*******************************************************************
// 二級域名服務器查詢 => 回應www.pchome.com.tw的IP
dig @210.242.216.93 www.pchome.com.tw

; <<>> DiG 9.10.6 <<>> @210.242.216.93 www.pchome.com.tw
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 58118
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 5, ADDITIONAL: 6
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;www.pchome.com.tw.		IN	A

;; ANSWER SECTION:
www.pchome.com.tw.	300	IN	A	34.110.144.106 // <=== PCHOME的IP

;; AUTHORITY SECTION:
pchome.com.tw.		300	IN	NS	cheetah.pchome.com.tw.
pchome.com.tw.		300	IN	NS	dns.pchome.com.tw.
pchome.com.tw.		300	IN	NS	dns2.pchome.com.tw.
pchome.com.tw.		300	IN	NS	wolf.pchome.com.tw.
pchome.com.tw.		300	IN	NS	dns3.pchome.com.tw.

;; ADDITIONAL SECTION:
dns.pchome.com.tw.	300	IN	A	210.59.230.85
dns2.pchome.com.tw.	300	IN	A	211.20.188.153
dns3.pchome.com.tw.	300	IN	A	34.80.229.255
cheetah.pchome.com.tw.	300	IN	A	210.242.216.93
wolf.pchome.com.tw.	300	IN	A	203.69.38.86

;; Query time: 301 msec
;; SERVER: 210.242.216.93#53(210.242.216.93)
;; WHEN: Wed Sep 07 12:49:42 CST 2022
;; MSG SIZE  rcvd: 239

//*******************************************************************
// nslookup查詢方式
nslookup -type=ns server dnsServer
```